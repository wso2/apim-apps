import React, { forwardRef } from "react";
import { useParams } from "react-router";

//material
import { Grid, Typography } from "@material-ui/core";
import { makeStyles } from "@material-ui/styles";
import logo from "../assets/wso2_logo.png";
//components
import VulnerabilityBoxToPrint from "./VulnerabilityBoxToPrint";

var moment = require("moment");
moment().format();

const useStyles = makeStyles(() => ({
  gridMain: {
    margin: "40px",
  },
  gridContent: {
    paddingBottom: "10px",
  },
  logoStyle: { height: "undefined", width: "80px" },
}));

const PrintPage = forwardRef(({ vulnerabilities, state }, ref) => {
  const classes = useStyles();

  const formattedDateNow = moment(new Date()).format("MMMM Do YYYY, h:mm:ss a");
  const { branch, portal } = useParams();
  let vulnerabilitiesArray;
  vulnerabilitiesArray = Object.entries(vulnerabilities);

  const vulnComponents = [];

  for (var i = 0; i < vulnerabilitiesArray.length; i++) {
    if (state === "all") {
      vulnComponents.push(
        <>
          <VulnerabilityBoxToPrint
            key={vulnerabilitiesArray[i][0]}
            vulnerability={vulnerabilitiesArray[i][1]}
            print={true}
          />
          <div style={{ pageBreakAfter: "always" }}></div>
        </>
      );
    } else {
      if (vulnerabilitiesArray[i][1]["metadata"]["state"] === state) {
        vulnComponents.push(
          <>
            {" "}
            <VulnerabilityBoxToPrint
              key={vulnerabilitiesArray[i][0]}
              vulnerability={vulnerabilitiesArray[i][1]}
              print={true}
            />
            <div style={{ pageBreakAfter: "always" }}></div>
          </>
        );
      }
    }
  }

  return (
    <Grid ref={ref} className={classes.gridMain}>
      <Grid container>
        <Grid xs={12} md={1}>
          <img src={logo} className={classes.logoStyle} alt="Wso2" />
        </Grid>
        <Grid xs={12} className={classes.gridContent}>
          <Typography variant="h4">
            <center>Security Vulnerability Analyzer</center>
          </Typography>
        </Grid>
        <Grid xs={12} className={classes.gridContent}>
          <Typography variant="h5">
            <center>Vulnerability Lookup</center>
          </Typography>
        </Grid>
        <Grid xs={12} className={classes.gridContent}>
          <Typography>
            <center>{formattedDateNow}</center>
          </Typography>
        </Grid>
        <Grid xs={12} className={classes.gridContent}>
          <Typography variant="h6">
            <b>Portal: </b>
            {portal[0].toUpperCase() + portal.substring(1)}
          </Typography>
        </Grid>
        <Grid xs={12}>
          <Typography variant="h6">
            <b>Branch: </b>
            {branch}
          </Typography>
        </Grid>
      </Grid>

      {vulnComponents}
    </Grid>
  );
});

export default PrintPage;
